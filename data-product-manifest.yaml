jobId: "1066"
jobName: Content 360
jobType: Aggregated Data Product
developerId: 2161a325-4de5-43e9-839a-8ee5c52cb81e
domain: cmt
alias: loading_Content_360_data_in_iceberg
discoveryPort:
  name: Content 360
inputPorts:
  - alias: Content_KPI_1
    isDynamic: true
    path: s3a://dataverse/testbed/cmt/adp_customer_360.csv
    optional:
      persistDataFrame: false
      advanceOptions:
        delimiter: ","
      enableDataReconciliation: false
      enforceSchema: false
      connection: S3 Connection - CMT
      dataSetUrn: urn:dv:dataset:1faa71a8-e540-4440-8b39-eed2b2311317
    type: inputDelimited
  - alias: Revenue_Attribution_1
    isDynamic: true
    dataProductUrn: urn:dv:dataproduct:6a33caf4-788d-499d-bc77-097f0a68321b
    filter: ""
    projection: ""
    optional:
      persistDataFrame: false
    type: dataproduct
  - alias: Engagement_Metrics_1
    isDynamic: true
    dataProductUrn: urn:dv:dataproduct:09580d65-48e3-4e81-bdf6-7784250401eb
    filter: ""
    projection: ""
    optional:
      persistDataFrame: false
    type: dataproduct
  - alias: Programming_&_Scheduling_Insights_1
    isDynamic: true
    dataProductUrn: urn:dv:dataproduct:d26ca940-0062-4360-b951-543c59babe4c
    filter: ""
    projection: ""
    optional:
      persistDataFrame: false
    type: dataproduct
  - alias: Content_Master_1
    isDynamic: true
    dataProductUrn: urn:dv:dataproduct:9047f7f9-ab59-4eff-bd19-20758cb6531c
    filter: ""
    projection: ""
    optional:
      persistDataFrame: false
    type: dataproduct
productState:
  isDynamic: true
  alias: loading_Content_360_data_in_iceberg
  retentionVersions: ""
  logicalSchema:
    properties:
      user_id:
        type: STRING
        description: Unique identifier of the user aggregated at ADP level
        sourceColumn: user_id
        sourceTable: Engagement Metrics
      reporting_month:
        type: STRING
        description: Reporting month derived from engagement activity date
        sourceColumn: activity_date
        sourceTable: Engagement Metrics
      country:
        type: STRING
        description: Country or geographic region of the user
        sourceColumn: region
        sourceTable: Engagement Metrics
      acquisition_channel:
        type: STRING
        description: Marketing or acquisition channel derived from campaign identifier
        sourceColumn: campaign_id
        sourceTable: Revenue Attribution
      subscription_plan:
        type: STRING
        description: Subscription plan or content associated with the user revenue
        sourceColumn: content_id
        sourceTable: Revenue Attribution
      total_sessions:
        type: STRING
        description: Total number of user sessions aggregated per reporting period
        sourceColumn: session_id
        sourceTable: Engagement Metrics
      active_days_count:
        type: STRING
        description: Number of distinct days the user was active
        sourceColumn: activity_date
        sourceTable: Engagement Metrics
      total_watch_time_sec:
        type: STRING
        description: Total watch time accumulated by the user
        sourceColumn: total_watch_time_sec
        sourceTable: Engagement Metrics
      avg_watch_time_per_session_sec:
        type: STRING
        description: Average watch time per session derived from total watch time and
          sessions
        sourceColumn: total_watch_time_sec
        sourceTable: Engagement Metrics
      bounce_rate_pct:
        type: STRING
        description: Percentage of sessions with single-page engagement
        sourceColumn: single_page_session_flag
        sourceTable: Engagement Metrics
      total_impressions:
        type: STRING
        description: Total impressions attributed to the user or campaign
        sourceColumn: total_impressions
        sourceTable: Revenue Attribution
      total_clicks:
        type: STRING
        description: Total clicks attributed to the user or campaign
        sourceColumn: total_clicks
        sourceTable: Revenue Attribution
      ctr_pct:
        type: STRING
        description: Click-through rate derived from clicks and impressions
        sourceColumn: total_clicks
        sourceTable: Revenue Attribution
      total_spend_amount:
        type: STRING
        description: Total marketing spend attributed to the user or campaign
        sourceColumn: spend_amount
        sourceTable: Revenue Attribution
      cpm_amount:
        type: STRING
        description: Cost per thousand impressions derived from spend and impressions
        sourceColumn: spend_amount
        sourceTable: Revenue Attribution
      total_revenue_amount:
        type: STRING
        description: Total revenue generated from the user
        sourceColumn: revenue_amount
        sourceTable: Revenue Attribution
      arpu_amount:
        type: STRING
        description: Average revenue per user derived at ADP level
        sourceColumn: revenue_amount
        sourceTable: Revenue Attribution
      churn_flag:
        type: STRING
        description: Indicator showing whether the user has churned
        sourceColumn: subscriber_id
        sourceTable: Revenue Attribution
      churn_rate_pct:
        type: STRING
        description: Percentage of users who churned in the reporting period
        sourceColumn: subscriber_id
        sourceTable: Revenue Attribution
      retention_rate_pct:
        type: STRING
        description: Percentage of users retained over the reporting period
        sourceColumn: subscriber_id
        sourceTable: Revenue Attribution
      customer_lifetime_months:
        type: STRING
        description: Customer lifetime calculated in months based on transaction history
        sourceColumn: attribution_date
        sourceTable: Revenue Attribution
  stateStoreType: loadDataIceberg
  isProfilingEnabled: true
  updateStrategy: Overwrite
  tableName: iceberg_meta.content_360
  warehousePath: s3a://dataverse/testbed_load/
  catalogName: postgres_catalog
  optional:
    persistDataFrame: false
    enableDataReconciliation: false
    enforceSchema: true
    enforceSchemaMethod: Warning
    catalogType: postgres
    connection: S3 Connection - CMT
    loggingOptions:
      printSchema: true
  refreshInterval: 30 5 * * *
transformation:
  - isDynamic: true
    alias: Spark_SQL_2
    description: Content 360
    sequence: 6
    inputDataFrameList:
      - inputDataFrame: Revenue_Attribution_1
        tempViewName: T1
      - inputDataFrame: Engagement_Metrics_1
        tempViewName: T2
      - inputDataFrame: Programming_&_Scheduling_Insights_1
        tempViewName: T3
      - inputDataFrame: Content_Master_1
        tempViewName: T4
      - inputDataFrame: Content_KPI_1
        tempViewName: T5
    query: select * from T5
    optional:
      persistDataFrame: false
      loggingOptions:
        printSchema: true
    type: operationThroughSqlQuery
controlPort:
  dataQualityRules:
    NullValueCheck:
      productState:
        checks:
          - column: user_id
        referenceAlias: loading_Content_360_data_in_iceberg
    DistinctValueCountCheck:
      productState:
        checks:
          - column: acquisition_channel
            expression: <=
            number: 3
        referenceAlias: loading_Content_360_data_in_iceberg
